<p-toast></p-toast>
<p-confirmDialog [style]="{width: '50vw'}"></p-confirmDialog>
<p-card>
	<p-tabMenu [model]="items" [activeItem]="activeItem" (activeItemChange)="onActiveItemChange($event)"></p-tabMenu>

	<div id="products" *ngIf="this.activeItem.label == 'Products'">
		<div class="flex justify-content-between mt-4">
			<div class="field grid">
				<label htmlFor="name3" class="col-12 mb-2 md:col-2 md:mb-0">Search</label>
				<div class="col-12 md:col-10">
					<span class="p-input-icon-left">
						<i class="pi pi-search"></i>
						<input type="text" pInputText (keyup)="filter($event)" />
					</span>
				</div>
			</div>
			<div class="flex justify-content-between gap-3">
				<p-multiSelect [options]="units" [(ngModel)]="filteredUnits" optionLabel="name"
					defaultLabel="Select a Unit">
				</p-multiSelect>
			</div>

		</div>
		<div class="flex flex-wrap gap-4" id="productView">
			<div *ngFor="let product of productList" style="width:32%;height:100%" class="my-2">
				<p-card header="{{product.pnscnm}}">
					<p class="card-text">{{product.pncmpy}}</p>
					<div class="flex row justify-content-between">
						<span>Product Code</span>
						<b>{{product.pnpdcd}}</b>
					</div>
					<div class="flex row justify-content-between">
						<span>Product Name</span>
						<b>{{product.pnscnm}}</b>
					</div>
					<div class="row flex justify-content-between">
						<span>Quantity</span>
						<b>{{product.pnuqty}}</b>
					</div>
					<div class="row flex justify-content-between">
						<span>Price</span>
						<b>{{product.pnmrp}}</b>
					</div>
					<div class="row flex justify-content-between">
						<span>Unit</span>
						<b>{{product.pnunit}}</b>
					</div>
					<div class="mt-4 flex justify-content-end gap-3">
						<p-button label="Add to Cart" styleClass="p-button-outlined" (click)="addToCart(product)"></p-button>
					</div>
				</p-card>
			</div>
		</div>
	</div>

	<div id="tax-invoice" *ngIf="this.activeItem.label == 'Invoice'">
		<div class="mt-4">
			<p-fieldset legend="Company Details" [toggleable]="true">
				<div class="grid">
					<div class="col">
						<div class="field grid">
							<label htmlFor="customerName" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">Customer Name</label>
							<div class="col-12 md:col-9">
								<input pInputText type="text"  [(ngModel)]="customerDetails.jpname"/>
							</div>
						</div>		
					</div>
					<div class="col">
						<div class="field grid">
							<label htmlFor="gst" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">GST</label>
							<div class="col-12 md:col-9">
								<input pInputText type="text" [(ngModel)]="customerDetails.jppgst"/>
							</div>
						</div>
					</div>
					<div class="col">
						<div class="field grid">
							<label htmlFor="mobile" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">Mobile</label>
							<div class="col-12 md:col-9">
								<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" [(ngModel)]="customerDetails.jpmobno"></p-inputNumber>
							</div>
						</div>
					</div>
					<div class="col">
						<div class="field grid">
							<label htmlFor="balance" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">Balance</label>
							<div class="col-12 md:col-9">
								<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" [(ngModel)]="customerDetails.jpbaln"></p-inputNumber>
							</div>
						</div>
					</div>
				</div>
				<div class="field grid">
					<label htmlFor="address" class="col-12 mb-2 md:col-1 md:mb-0 font-bold">Address</label>
					<div class="col-12 md:col-10">
						<textarea rows="2" cols="120" pInputTextarea [autoResize]="true" [(ngModel)]="customerDetails.jpadd"></textarea>
					</div>
				</div>
			</p-fieldset>
		</div>

		<div class="mt-4">
			<p-fieldset legend="Tax Invoice">
				<div class="flex justify-content-between">
					<div class="field grid">
						<label htmlFor="customerName" class="col-12 mb-2 md:col-5 md:mb-0 font-bold">Invoice Number</label>
						<div class="col-12 md:col-7">
							<input pInputText type="text"  [(ngModel)]="customerDetails.jpname"/>
						</div>
					</div>
					<div class="field grid">
						<label htmlFor="customerName" class="col-12 mb-2 md:col-5 md:mb-0 font-bold">Invoice Date</label>
						<div class="col-12 md:col-7">
							<input pInputText type="text"  [(ngModel)]="customerDetails.jpname"/>
						</div>
					</div>
				</div>
				<p-table [value]="selectedProducts" dataKey="pnpdcd" editMode="row" 
					[tableStyle]="{ 'min-width': '50rem' }"
					[rows]="10"
					[showCurrentPageReport]="false"
					[rowsPerPageOptions]="[10, 25, 50]"
					[paginator]="true"
    				currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
				>
				<ng-template pTemplate="header">
					<tr>
						<th style="width:10%"></th>
						<th style="width:10%">Challan</th>
						<th style="width:25%">Product</th>
						<th style="width:15%">HSNC</th>
						<th style="width:10%">Total Qty</th>
						<th style="width:10%">Unit Qty</th>
						<th style="width:10%">Unit</th>
						<th style="width:10%">Price</th>
						<th style="width:10%">CGST (%)</th>
						<th style="width:10%">CGST</th>
						<th style="width:10%">SGST (%)</th>
						<th style="width:10%">SGST</th>
						<th style="width:10%">Final Price</th>
						<th style="width:10%"></th>
					</tr>
				</ng-template>
				<ng-template pTemplate="emptymessage" let-columns>
					<tr>
						<td [attr.colspan]="14" class="text-center">
							No records found
						</td>
					</tr>
				</ng-template>
				<ng-template pTemplate="body" let-cproduct let-editing="editing" let-index="rowIndex">
					<tr [pEditableRow]="cproduct" [pReorderableRow]="index">
						<td><span class="pi pi-bars" pReorderableRowHandle></span></td>
						<td [pEditableColumn]="cproduct.pnchallan" pEditableColumnField="pnchallan">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<input pInputText type="text" [(ngModel)]="cproduct.pnchallan">
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnchallan}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pnscnm" pEditableColumnField="pnscnm">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<input pInputText type="text" [(ngModel)]="cproduct.pnscnm">
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnscnm}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pnhsnc" pEditableColumnField="pnhsnc">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<input pInputText type="text" [(ngModel)]="cproduct.pnhsnc">
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnhsnc}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pntqty" pEditableColumnField="pntqty">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
										[(ngModel)]="cproduct.pntqty"></p-inputNumber>
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pntqty}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pnuqty" pEditableColumnField="pnuqty">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
										[(ngModel)]="cproduct.pnuqty"></p-inputNumber>
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnuqty}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pnunit" pEditableColumnField="pnunit">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<input pInputText type="text" [(ngModel)]="cproduct.pnunit">
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnunit}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pnnamt" pEditableColumnField="pnnamt">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
										[(ngModel)]="cproduct.pnnamt"></p-inputNumber>
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnnamt}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pncgst" pEditableColumnField="pncgst">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
										[(ngModel)]="cproduct.pncgst"></p-inputNumber>
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pncgst}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pncgsta" pEditableColumnField="pncgsta">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
										[(ngModel)]="cproduct.pncgsta"></p-inputNumber>
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pncgsta}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pnsgst" pEditableColumnField="pnsgst">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
										[(ngModel)]="cproduct.pnsgst"></p-inputNumber>
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnsgst}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pnsgsta" pEditableColumnField="pnsgsta">
							<p-cellEditor>
								<ng-template pTemplate="input">
									<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
										[(ngModel)]="cproduct.pnsgsta"></p-inputNumber>
								</ng-template>
								<ng-template pTemplate="output">
									{{cproduct.pnsgsta}}
								</ng-template>
							</p-cellEditor>
						</td>
						<td [pEditableColumn]="cproduct.pntamt" pEditableColumnField="pntamt">{{cproduct.pntamt}}</td>
						<td>
							<div class="flex align-items-center justify-content-center gap-2">
							</div>
						</td>
					</tr>
				</ng-template>
				<ng-template pTemplate="paginatorleft">
					<p-button type="button" icon="pi pi-plus-circle" styleClass="p-button-text" (click)="visible = true"></p-button>
				</ng-template>
			</p-table>
			
			<!--Final Total & GST Summary-->
			<p-card header="Bill Summary">
				<div class="flex justify-content-between">
					<div>
						<table class="table">
							<thead>
								<th class="text-center">GST Type</th>
								<th class="text-center">Net Amount</th>
								<th class="text-center">Total CGST</th>
								<th class="text-center">Total SGST</th>
								<th class="text-center">Total Amount</th>
							</thead>
							<tbody>
								<tr *ngFor="let gst of gstSummary| keyvalue">
									<td>{{gst.value.gngstp}}</td>
									<td class="text-right">{{gst.value.gnnamt | number : '1.2-2'}}</td>
									<td class="text-right">{{gst.value.gntcgst | number : '1.2-2'}}</td>
									<td class="text-right">{{gst.value.gntcgst | number : '1.2-2'}}</td>
									<td class="text-right">{{gst.value.gntamt | number : '1.2-2'}}</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div style="width: 200px;" class="mr-4">
						<table class="table">
							<tbody>
								<tr>
									<td>Net Amount</td>
									<td class="text-right">{{billSummary.bsnamt | number : '1.2-2'}}</td>
								</tr>
								<tr>
									<td>Total CGST</td>
									<td class="text-right">{{billSummary.bstcgst | number : '1.2-2'}}</td>
								</tr>
								<tr>
									<td>Total SGST</td>
									<td class="text-right">{{billSummary.bstsgst | number : '1.2-2'}}</td>
								</tr>
								<tr>
									<td>Total Amount</td>
									<td class="text-right">{{billSummary.bstamt | number : '1.2-2'}}</td>
								</tr>
								<tr>
									<td>Rounded Off</td>
									<td class="text-right">{{billSummary.bsroff | number : '1.2-2'}}</td>
								</tr>
								<tr>
									<td>Final Amount</td>
									<td class="text-right">{{billSummary.bsfamt | number : '1.2-2'}}</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</p-card>

			</p-fieldset>
		</div>
	</div>

</p-card>


<p-dialog header="Add New Product" [(visible)]="visible" [position]="position" [style]="{ width: '80vw' }">
	<div class="grid">
		<div class="col">
			<p-fieldset legend="Description">
				<div class="field grid">
					<label htmlFor="customerName" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">
						Product Name<span class="text-danger">&nbsp;*</span>
					</label>
					<div class="col-12 md:col-9">
						<input pInputText type="text" style="width: 100%;" [(ngModel)]="newProduct.pnscnm"/>
					</div>
				</div>
				<div class="field grid">
					<label htmlFor="mobile" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">
						Unit Qty<span class="text-danger">&nbsp;*</span>
					</label>
					<div class="col-12 md:col-9">
						<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
							[(ngModel)]="newProduct.pnuqty"></p-inputNumber>
					</div>
				</div>

				<div class="field grid">
					<label htmlFor="customerName" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">
						Unit<span class="text-danger">&nbsp;*</span>
					</label>
					<div class="col-12 md:col-9">
						<p-dropdown [options]="units" [(ngModel)]="filteredUnits" optionLabel="name"></p-dropdown>
					</div>
				</div>
				<div class="field grid">
					<label htmlFor="mobile" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">
						Product Price<span class="text-danger">&nbsp;*</span>
					</label>
					<div class="col-12 md:col-9">
						<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
							[(ngModel)]="newProduct.pnmcpr"></p-inputNumber>
					</div>
				</div>
			</p-fieldset>
		</div>
		<div class="col">
			<p-fieldset legend="GST">
				<div class="field grid">
					<label htmlFor="mobile" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">
						HSNC<span class="text-danger">&nbsp;*</span>
					</label>
					<div class="col-12 md:col-9">
						<input pInputText type="text" style="width: 100%;" [(ngModel)]="newProduct.pnhsnc"/>
					</div>
				</div>
				<div class="field grid">
					<label htmlFor="mobile" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">
						CGST<span class="text-danger">&nbsp;*</span>
					</label>
					<div class="col-12 md:col-9">
						<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
							[(ngModel)]="newProduct.pncgst"></p-inputNumber>
					</div>
				</div>
				<div class="field grid">
					<label htmlFor="mobile" class="col-12 mb-2 md:col-3 md:mb-0 font-bold">
						SGST<span class="text-danger">&nbsp;*</span>
					</label>
					<div class="col-12 md:col-9">
						<p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false" 
							[(ngModel)]="newProduct.pnsgst"></p-inputNumber>
					</div>
				</div>
			</p-fieldset>
		</div>
	</div>
	
	<div class="flex justify-content-end gap-3">
		<p-button label = "Add" (click)="addProduct()"></p-button>
		<p-button label = "Clear" (click)="clearProduct()"></p-button>
	</div>
</p-dialog>