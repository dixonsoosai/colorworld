<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "medium" color = "#fff" type = "ball-beat" [fullScreen] = "true"><p style="color: white" > Loading... </p></ngx-spinner>
<p-toast></p-toast>
<p-confirmDialog [style]="{width: '50vw'}"></p-confirmDialog>  
<div class="flex my-4">
    <div class="flex gap-3">
        <button pButton label="Clear" pRipple class="p-button-outlined" icon="pi pi-filter-slash" (click)="clear(dt1)"></button>
        <button pButton label="Download" pRipple class="p-button-outlined" icon="pi pi-file-excel" (click)="exportExcel(dt1)" pTooltip="XLSX" tooltipPosition="bottom"></button>
        <div>
            Date:&nbsp;&nbsp;
            <p-calendar [(ngModel)]="filterDate" view="month" dateFormat="mm-yy" (onSelect) ="filterInvoice()" #filter></p-calendar>
        </div>
    </div>
    <span class="p-input-icon-left ml-auto">
        <i class="pi pi-search"></i>
        <input pInputText type="text" id="searchText" (input)="dt1.filterGlobal($event.target.value, 'contains')" placeholder="Search keyword" />
    </span>
</div>

<p-table #dt1 [value]="invoiceDetails" [tableStyle]="{ 'min-width': '50rem' }"
    [paginator]="true"
    [rows]="10"
    [loading]="loading"
    [showCurrentPageReport]="true"
    [rowsPerPageOptions]="[10, 25, 50]"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [globalFilterFields]="['tnbillno', 'tntime', 'tnname','tnpgst','gngstp','gntxable','gncamt', 'gnsamt', 'gntamt']"
    >
    <ng-template pTemplate="header" let-columns>
        <tr>
            <th>
                <div class="flex align-items-center">
                Invoice
                <p-columnFilter type="text" field="tnbillno" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                Invoice Date
                <p-columnFilter type="date" field="tntime" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                Company Name
                <p-columnFilter type="text" field="tnname" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                Company GST
                <p-columnFilter type="text" field="tnpgst" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                GST %
                <p-columnFilter type="text" field="gngstp" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                Total Amount
                <p-columnFilter type="numeric" field="gntxable" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                CGST
                <p-columnFilter type="numeric" field="gncamt" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                SGST
                <p-columnFilter type="numeric" field="gnsamt" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>
                <div class="flex align-items-center">
                Grand Total
                <p-columnFilter type="numeric" field="gntamt" display="menu"></p-columnFilter>
                </div>
            </th>
            <th>Action</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-rowData>
        <tr>
            <td>{{rowData.tnbillno}}</td>
            <td>{{rowData.tntime | date: 'dd-MM-yyyy'}}</td>
            <td>{{rowData.tnname}}</td>
            <td>{{rowData.tnpgst}}</td>
            <td class="text-right">{{rowData.gngstp}}</td>
            <td class="text-right">{{rowData.gntxable | number : '1.2-2'}}</td>
            <td class="text-right">{{rowData.gncamt | number : '1.2-2'}}</td>
            <td class="text-right">{{rowData.gnsamt | number : '1.2-2'}}</td>
            <td class="text-right">{{rowData.gntamt | number : '1.2-2'}}</td>
            <td>
                <div class="flex gap-3">
                    <a [routerLink]="['/home/tax-invoice/' + rowData.tnbillno]">
                        <i class="pi pi-eye" style="font-size: 1.5rem;cursor: pointer;" pTooltip="View" 
                            tooltipPosition="bottom">
                        </i>
                    </a>
                    <!--
                    <i class="pi pi-download" style="font-size: 1.5rem;cursor: pointer;color:green" pTooltip="Download" 
                        tooltipPosition="bottom" (click)="download(rowData)"></i>
                    -->
                    <i class="pi pi-trash" style="font-size: 1.5rem;cursor: pointer;color:red" pTooltip="Delete" 
                        tooltipPosition="bottom" (click)="delete(rowData)"></i>
                </div>
            </td>
    </ng-template>
    <ng-template pTemplate="paginatorleft">
        <i class="pi pi-filter-slash" style="font-size: 1.5rem;cursor: pointer;" pTooltip="Clear Filter" 
        tooltipPosition="bottom" (click)="clear(dt1)"></i>
    </ng-template>
    <ng-template pTemplate="paginatorright">
        <i class="pi pi-file-excel" style="font-size: 2rem;cursor: pointer;" pTooltip="XLSX" 
        tooltipPosition="bottom" (click)="exportExcel(dt1)"></i>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td colspan="10">No records found</td>
        </tr>
        </ng-template>
</p-table>
